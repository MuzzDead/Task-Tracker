@page "/boards/{boardId:guid}"
@using AntDesign
@using TaskTracker.Client.Components.Columns
@using TaskTracker.Client.Components.Boards
@using TaskTracker.Client.Components.Cards
@using TaskTracker.Client.Components.Member

<div class="board-details-container">
    <BoardsHeader Title=@(_boardState.Board?.Title ?? "Loading…")
                  ShowSearch="false"
                  ShowMembersButton="true"
                  OnOpenMembers=@OpenMembersDrawer
                  OnCreateClick=@ShowColumnModal
                  ButtonText="Add Column"
                  EnableTitleEdit=@(_boardState.Board != null)
                  IsTitleEditing=@_boardState.IsTitleEditing
                  OnTitleEditingChanged=@OnTitleEditingChanged
                  IsTitleSaving=@_boardState.IsTitleSaving
                  OnTitleSave=@SaveBoardTitle
                  OnArchiveBoard=@ArchiveBoard />

    @if (!string.IsNullOrEmpty(_boardState.Error))
    {
        <Alert Type=@AlertType.Error Message=@_boardState.Error />
    }
    else if (_boardState.IsLoading)
    {
        <Spin Tip="Loading board…" />
    }
    else
    {
        <ColumnList Columns=@_boardState.Columns
                    CardsByColumn=@_boardState.CardsByColumn
                    IsLoading="false"
                    EditingColumnId=@_boardState.EditingColumnId
                    EditingColumnIdChanged=@OnColumnTitleEditingChanged
                    IsColumnTitleSaving=@_boardState.IsColumnTitleSaving
                    OnColumnTitleSave=@SaveColumnTitle
                    OnAddCard=@OnAddCard
                    OnCardClick=@OnCardClick
                    OnEditColumn=@OnColumnEdit
                    OnDeleteColumn=@OnColumnDelete />
    }

    <CreateColumn IsVisible=@_boardState.IsColumnModalVisible
                  IsVisibleChanged=@HideColumnModal
                  OnColumnCreated=@HandleColumnCreated
                  BoardId=@boardId />

<CardDetailsModal IsVisible=@_cardModalState.IsVisible
           IsVisibleChanged=@OnCardModalVisibleChanged
           Card=@_cardModalState.SelectedCard
           Comments=@_cardModalState.Comments
           IsTitleEditing=@_cardModalState.IsTitleEditing
           IsTitleSaving=@_cardModalState.IsTitleSaving
           OnTitleEditingChanged=@OnTitleEditingChanged
           OnTitleSave=@OnTitleSave
           IsCommentsLoading=@_cardModalState.IsCommentsLoading
           IsCommentSubmitting=@_cardModalState.IsCommentSubmitting
           OnCommentSubmit=@OnCommentSubmit
           OnCommentEdit=@OnCommentEdit
           OnCommentDelete=@OnCommentDelete
           IsDeleting=@_cardModalState.IsCardDeleting
           OnCardDelete=@OnCardDelete
           IsTaskCompleted=@_cardModalState.IsCompleted
           OnTaskComplete=@OnTaskComplete
           State=@_cardModalState.State
           AssignedUser=@_cardModalState.AssignedUser
           IsAssigneeLoading=@_cardModalState.IsAssigneeLoading
           IsRemovingAssignment=@_cardModalState.IsRemovingAssignment
           IsCurrentUserAssigned=@_cardModalState.IsCurrentUserAssigned
           OnRemoveAssignment=@OnRemoveAssignment
           OnOpenAssignModal=@OnOpenAssignModal
           OnStateEdit=@OnStateEdit
           IsAssignModalVisible=@_cardModalState.IsAssignModalVisible
           BoardMembers=@_cardModalState.BoardMembers
           IsMembersLoading=@_cardModalState.IsMembersLoading
           IsAssigningUser=@_cardModalState.IsAssigningUser
           OnAssignUser=@OnAssignUser
           OnCloseAssignModal=@OnCloseAssignModal />

    <MemberList BoardId=@boardId
                Members=@Members
                CurrentUserId=@GetCurrentUserId()
                MembersDrawerVisible=@MembersDrawerVisible
                InviteModalVisible=@InviteModalVisible
                IsLoading=@IsMembersLoading
                ErrorMessage=@MembersErrorMessage
                CurrentInviteStep=@CurrentInviteStep
                SearchEmail=@SearchEmail
                SearchEmailChanged=@(async (value) => SearchEmail = value)
                SearchError=@SearchError
                FoundUser=@FoundUser
                SelectedRole=@SelectedRole
                SelectedRoleChanged=@(async (value) => SelectedRole = value)
                IsSearching=@IsSearching
                IsSendingInvite=@IsSendingInvite
                OnMembersDrawerClose=@OnMembersDrawerClose
                OnOpenInviteModal=@OpenInviteModal
                OnCloseInviteModal=@CloseInviteModal
                OnEditRole=@HandleEditRole
                OnRemoveMember=@HandleRemoveMember
                OnUserSearch=@HandleUserSearch
                OnSendInvite=@HandleSendInvite
                OnBackToSearch=@BackToSearch />
</div>