@using AntDesign
@using Microsoft.AspNetCore.Components

<div class="comment-card">
    <div class="comment-header">
        <div class="author-info">
            <Avatar Size="@AvatarSize.Small"
                    Icon="user"
                    Class="author-avatar" />
            <div class="author-details">
                <span class="author-name">@Comment.CreatedBy</span>
                <span class="comment-date">@FormatDate(Comment.CreatedAt)</span>
            </div>
        </div>

        <Dropdown Trigger="@(new Trigger[] { Trigger.Click })"
                  Placement="@Placement.BottomRight">
            <Overlay>
                <Menu>
                    <MenuItem Key="edit" OnClick="@(() => StartEdit())">
                        <Icon Type="edit" />
                        Edit
                    </MenuItem>
                    <MenuItem Key="delete" OnClick="@(() => DeleteComment())" Class="delete-menu-item">
                        <Icon Type="delete" />
                        Delete
                    </MenuItem>
                </Menu>
            </Overlay>
            <ChildContent>
                <Button Type="@ButtonType.Text"
                        Size="@ButtonSize.Small"
                        Icon="more"
                        Class="comment-menu-btn" />
            </ChildContent>
        </Dropdown>
    </div>

    <div class="comment-content">
        @if (IsEditing)
        {
            <div class="edit-form">
                <TextArea @bind-Value="EditContent"
                          AutoSize="true"
                          MinRows="2"
                          MaxRows="6"
                          MaxLength="1000"
                          ShowCount="true"
                          @onkeydown="HandleKeyDown"
                          @ref="EditTextAreaRef"
                          class="edit-textarea" />

                <div class="edit-actions">
                    <Button Type="@ButtonType.Primary"
                            Size="@ButtonSize.Small"
                            Icon="check"
                            @onclick="SaveEdit"
                            Loading="@IsSaving"
                            Disabled="@string.IsNullOrWhiteSpace(EditContent)">
                        Save
                    </Button>
                    <Button Type="@ButtonType.Default"
                            Size="@ButtonSize.Small"
                            Icon="close"
                            @onclick="CancelEdit"
                            Disabled="@IsSaving">
                        Cancel
                    </Button>
                </div>
            </div>
        }
        else
        {
            <div class="comment-text">
                @((MarkupString)FormatContent(Comment.Text))
            </div>
        }
    </div>
</div>

