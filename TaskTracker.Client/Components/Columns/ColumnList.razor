@using AntDesign
@using TaskTracker.Client.DTOs.Column
@using TaskTracker.Client.DTOs.Card
@using TaskTracker.Client.Components.Cards
@using TaskTracker.Client.Components.Columns
@using Microsoft.AspNetCore.Components

<div class="column-list">
    @if (IsLoading)
    {
        <Spin Tip="Loading columns..." />
    }
    else if (Columns?.Any() == true)
    {
        @foreach (var column in Columns)
        {
            <ColumnCard Column="column"
                        Cards="GetCards(column.Id)"
                        IsLoading="false"
                        OnCardClick="OnCardClick"
                        OnAddCard="OnAddCard" />
        }
    }
    else
    {
        <div class="no-columns">No columns available.</div>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public List<ColumnDto> Columns { get; set; } = new();

    [Parameter, EditorRequired]
    public Dictionary<Guid, List<CardDto>> CardsByColumn { get; set; } = new();

    [Parameter]
    public bool IsLoading { get; set; }

    [Parameter]
    public EventCallback<CardDto> OnCardClick { get; set; }

    [Parameter]
    public EventCallback<(string title, Guid columnId)> OnAddCard { get; set; }

    [Parameter]
    public EventCallback<(CardDto card, Guid columnId)> OnCardDrop { get; set; }

    [Parameter]
    public EventCallback<string> OnAddColumn { get; set; }

    private List<CardDto> GetCards(Guid columnId)
      => CardsByColumn.TryGetValue(columnId, out var list) ? list : new();
}
<style>
    .column-list {
        display: flex;
        gap: 16px;
        padding: 16px;
        overflow-x: auto;
    }

    .no-columns {
        font-style: italic;
        color: #999;
    }

</style>